name: "Terraform Cloud Drift Check"

on:
#  schedule:
#    - cron: '*/15 * * * *'
 workflow_dispatch:

jobs:
  drift-check:
    uses: gr-oss-developers/github-configuration-self-service/.github/workflows/drift-check.yaml@main
    with:
      gcss_ref: main

#    name: "Drift Check"
#    runs-on: ubuntu-latest
#    environment: schedule-${{ matrix.environment }}-${{ matrix.owner }}
#    strategy:
#      fail-fast: false
#      matrix:
#        environment: ["prod"]
#        owner: ["G-Research", "armadaproject"]
#        include:
#          - environment: "dev"
#            owner: "gr-oss-devops"
#          - environment: "dev"
#            owner: "gr-oss-developers"
#
#    steps:
#      - name: Checkout repository
#        uses: actions/checkout@v3
#
#      - name: Run Terraform Cloud drift check
#        id: drift
#        uses: ./.github/actions/drift-detector
#        with:
#          tfc-token: ${{ secrets.TFC_TOKEN }}
#          workspace-id: ${{ vars.WORKSPACE_ID }}
#          polling-interval: 30
#
#      - name: Inspect drift
#        run: |
#          if [[ "${{ steps.drift.outputs.drift }}" == "true" ]]; then
#            echo "Drift detected!"
#            exit 1
#          else
#            echo "No drift detected."
#          fi